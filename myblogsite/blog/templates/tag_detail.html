{% extends 'base.html' %}
{% load static %}

{% block extra_head %}
{% comment %} <link rel="stylesheet" type="text/css" href="{% static 'css/post_detail.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'css/post.css' %}"> {% endcomment %}
<link rel="stylesheet" type="text/css" href="{% static 'css/base.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'css/homepage.css' %}">

{% endblock %}
{% block content %}
    <h1>Tag: {{ tag.name }}</h1>

    <!-- Button to toggle favorite status -->
    {% if request.user.is_authenticated %}
        <button id="favourite-toggle" data-tag-slug="{{ tag.slug }}" data-action="{% if is_favourite %}remove{% else %}add{% endif %}">
            {% if is_favourite %}
                Remove from Favourites
            {% else %}
                Add to Favourites
            {% endif %}
        </button>
    {% endif %}


    <!-- Rest of your content -->
    {% for post in posts %}
        <div><a href="{% url 'post_detail' post.slug %}">{{ post.title }}</a></div>
    {% endfor %}
{% endblock %}
{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const button = document.getElementById('favourite-toggle');
        button.addEventListener('click', function(e) {
            e.preventDefault();
            const action = button.getAttribute('data-action');
            const tagSlug = button.getAttribute('data-tag-slug');

            fetch('{% url 'toggle_favourite_tag' tag_slug=tag.slug %}', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',  // Django's CSRF token
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({'action': action})
            })
            .then(response => response.json())
            .then(data => {
                if (data.action === 'added') {
                    button.textContent = 'Remove from Favourites';
                    button.setAttribute('data-action', 'remove');
                } else {
                    button.textContent = 'Add to Favourites';
                    button.setAttribute('data-action', 'add');
                }
            });
        });
    });
</script>
{% endblock %}
